# 9. Local Development Environment

This document describes how to set up and run the project locally using the Docker Compose environment located in the `development/` directory.

## Directory Overview

- **`development/`**: The main directory for the local Docker Compose setup.
    - **`docker-compose.yml`**: The main file that defines all the services (backend, frontend, databases, etc.) and how they connect.
    - **`docker/`**: Contains the specific Docker configurations for each service.
        - `php/`: Holds the `Dockerfile`, `Caddyfile` (for the webserver), and `php.ini` for the backend PHP application.
- **`microservices/payments/Dockerfile`**: The Dockerfile used to build the Go payments microservice container.
- **`Dockerfile`**: The root Dockerfile is also used for the backend service.

## Setup and Workflow Scripts

A set of shell scripts is provided in the `development/` directory to manage the lifecycle of the local environment.

### First-Time Setup
- **`build.sh`**: This is the first script you must run to set up the project locally. It builds all the necessary Docker images from scratch, including the backend, frontend, and payments microservice.

### Daily Workflow
- **`development.sh`**: Use this script to start and run the environment after the initial setup. It will start all the services defined in `docker-compose.yml`.
- **`Makefile`**: **[DEPRECATED]** This file contains older commands and is scheduled for deletion. Please use the `.sh` scripts instead.

### Cleanup Scripts
- **`remove-containers-data.sh`**: This script is used to perform a hard reset of the Docker environment. It will stop the containers and remove all associated volumes, effectively deleting all data (e.g., database contents, message queue messages).
- **`remove-frontend-build-files.sh`**: This utility script removes build artifacts generated by the Next.js frontend, which can be useful for forcing a clean rebuild.

## Docker Compose Services

The `docker-compose.yml` defines the following services:

### Infrastructure Services
- **shop-system-mysql**: MySQL 9.1 database server
- **shop-system-elasticsearch**: Elasticsearch 8.18 for product search
- **shop-system-redis**: Redis 7.4 for caching
- **shop-system-rabbitmq**: RabbitMQ 4.1 for message queuing
- **shop-system-mailhog**: MailHog for email testing

### Application Services
- **shop-system-backend**: PHP Symfony backend (main application)
- **shop-system-payments**: Go payments microservice
- **shop-system-frontend**: Next.js frontend application

### Worker Services
- **shop-system-worker-async**: Processes async Symfony commands (e.g., email sending)
- **shop-system-worker-payments**: Processes payment events from Go microservice

All services read environment variables from the project's `.env` file and start automatically when running `./development.sh`.

### Viewing Worker Logs
```bash
docker logs -f shop-system-worker-async
docker logs -f shop-system-worker-payments
```

### Restarting Workers
```bash
docker-compose restart shop-system-worker-async
docker-compose restart shop-system-worker-payments
```
